# üîß –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π Webhook Server

## üö® **–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
–û—à–∏–±–∫–∏ HTTP 500 –≤ endpoint `/admin/update_configs/<purchase_id>`

## üîç **–®–∞–≥–∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π:**

### 1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
echo $WEBHOOK_DOMAIN
echo $ADMIN_API_KEY
```

### 2. **–¢–µ—Å—Ç endpoint webhook**
```bash
# –¢–µ—Å—Ç endpoint –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ purchase
curl -X GET "https://YOUR_DOMAIN/admin/test/1"

# –¢–µ—Å—Ç endpoint –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è configs
curl -X POST "https://YOUR_DOMAIN/admin/update_configs/1" \
  -H "Authorization: Bearer YOUR_API_KEY"
```

### 3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ webhook server**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ webhook server
tail -f /var/log/webhook_server.log
```

## üõ†Ô∏è **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:**

### ‚úÖ **1. –£–ª—É—á—à–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è sub_id –∏ server_id
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ active –ø–æ–∫—É–ø–∫–∏
- –ú–µ—Ö–∞–Ω–∏–∑–º fallback –¥–ª—è –ø–æ–∫—É–ø–æ–∫ –ø—Ä–æ—Ñ–∏–ª–µ–π

### ‚úÖ **2. –ù–æ–≤—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π endpoint**
- `/admin/test/<purchase_id>` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–∫—É–ø–∫–∏
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ–∫—É–ø–∫–∏ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ API key

### ‚úÖ **3. –£–ª—É—á—à–µ–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ ADMIN_API_KEY
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø–æ–∫—É–ø–∫–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ active –ø–æ–∫—É–ø–∫–∏

## üîß **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –æ—Ç–ª–∞–¥–∫–∏:**

### **1. –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –æ—Ç–ª–∞–¥–∫–∏:**
```bash
python debug_webhook.py
```

### **2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–ª—É—á—à–µ–Ω–Ω—ã—Ö –ª–æ–≥–æ–≤:**
–ù–æ–≤—ã–µ –ª–æ–≥–∏ –≤–∫–ª—é—á–∞—é—Ç –±–æ–ª–µ–µ —Ç–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:
- –¢–∏–ø –ø–æ–∫—É–ø–∫–∏ (profile –∏–ª–∏ normal)
- –°—Ç–∞—Ç—É—Å server –∏ sub_id
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö config
- –¢–æ—á–Ω—ã–µ –æ—à–∏–±–∫–∏ —Å traceback

## üìã **–ß–µ–∫-–ª–∏—Å—Ç —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π:**

### **–î–ª—è –∫–∞–∂–¥–æ–π –ø–æ–∫—É–ø–∫–∏ —Å –æ—à–∏–±–∫–æ–π:**
1. ‚úÖ –°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø–æ–∫—É–ø–∫–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö?
2. ‚úÖ –ï—Å—Ç—å –ª–∏ sub_id?
3. ‚úÖ –ï—Å—Ç—å –ª–∏ server_id (–¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–∫—É–ø–æ–∫)?
4. ‚úÖ –ï—Å—Ç—å –ª–∏ profile_id (–¥–ª—è –ø–æ–∫—É–ø–æ–∫ –ø—Ä–æ—Ñ–∏–ª–µ–π)?
5. ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ –ª–∏?
6. ‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω –ª–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å–µ—Ä–≤–µ—Ä?

### **–î–ª—è webhook server:**
1. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–∏ ADMIN_API_KEY?
2. ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ª–∏ WEBHOOK_DOMAIN?
3. ‚úÖ –ó–∞–ø—É—â–µ–Ω –ª–∏ webhook server?
4. ‚úÖ –î–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö?

## üöÄ **–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:**

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞ –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, —á—Ç–æ–±—ã —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É. –í–µ—Ä–æ—è—Ç–Ω–æ, –ø—Ä–æ–±–ª–µ–º–∞ –≤ –æ–¥–Ω–æ–º –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö:

1. **–ù–µ–ø–æ–ª–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏:** –ü–æ–∫—É–ø–∫–∏ –±–µ–∑ sub_id –∏–ª–∏ server_id
2. **–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã:** –°–µ—Ä–≤–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
3. **–ù–µ–ø–æ–ª–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏:** –ü—Ä–æ—Ñ–∏–ª–∏ –±–µ–∑ inbound
4. **–°–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:** –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–Ω–µ–ª—è–º X-UI

## üìû **–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–º–æ—â—å:**

–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–∫—Ä–∏–ø—Ç–∞ –æ—Ç–ª–∞–¥–∫–∏, —á—Ç–æ–±—ã —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É.