# راهنمای API Key ادمین

## 🔑 ADMIN_API_KEY چیست؟

**ADMIN_API_KEY** یک کلید امنیتی است که برای احراز هویت درخواست‌های ادمین به webhook server استفاده می‌شود.

### 🎯 کاربردها:

1. **احراز هویت درخواست‌ها**: همه درخواست‌های ادمین به webhook server نیاز به این کلید دارند
2. **امنیت**: از دسترسی غیرمجاز به endpoint های ادمین جلوگیری می‌کند
3. **کنترل دسترسی**: فقط ادمین‌های مجاز می‌توانند از API استفاده کنند

### 📡 نحوه استفاده:

```http
POST /admin/update_configs/{purchase_id}
Authorization: Bearer your-secret-api-key
```

## 🛠️ تنظیم API Key از طریق پنل ادمین

### مراحل:

1. **ورود به منوی ادمین**:
   ```
   /admin
   ```

2. **انتخاب دکمه تنظیم API Key**:
   ```
   🔑 تنظیم API Key
   ```

3. **مشاهده API Key فعلی**:
   ```
   API Key فعلی: abc12345...xyz789
   ```

4. **وارد کردن API Key جدید**:
   ```
   مثال: my-secure-api-key-2024
   ```

5. **تایید و ذخیره**:
   ```
   ✅ API Key با موفقیت بروزرسانی شد!
   ```

## 🔒 الزامات API Key

### ✅ مجاز:
- حروف انگلیسی (a-z, A-Z)
- اعداد (0-9)
- کاراکترهای خاص: `-`, `_`, `.`
- حداقل 16 کاراکتر

### ❌ غیرمجاز:
- فاصله (space)
- کاراکترهای خاص دیگر
- کمتر از 16 کاراکتر

## 📝 نمونه‌های API Key معتبر

```
✅ my-secure-api-key-2024
✅ alamor_vpn_admin_key_2024
✅ admin.api.key.secure.123
✅ my_secure_key_2024_v2
```

## 📝 نمونه‌های API Key نامعتبر

```
❌ short-key          (کمتر از 16 کاراکتر)
❌ my key with space  (دارای فاصله)
❌ key@with#symbols   (کاراکترهای غیرمجاز)
❌ key/with\slashes   (کاراکترهای غیرمجاز)
```

## 🔧 تنظیم دستی در فایل .env

اگر می‌خواهید API Key را مستقیماً در فایل `.env` تنظیم کنید:

```bash
# فایل .env
ADMIN_API_KEY="your-secure-api-key-here"
```

## 🚀 راه‌اندازی کامل

### 1. تنظیم API Key:
```
منوی ادمین → 🔑 تنظیم API Key → وارد کردن کلید جدید
```

### 2. راه‌اندازی Webhook Server:
```bash
python webhook_server.py
```

### 3. تست عملکرد:
```
منوی ادمین → 🔄 بروزرسانی همه لینک‌ها
```

## 🔍 عیب‌یابی

### مشکل 1: "خطای 401 Unauthorized"

**علت:** API Key اشتباه یا تنظیم نشده

**راه حل:**
1. بررسی صحت API Key در فایل `.env`
2. اطمینان از یکسان بودن کلید در ربات و webhook server
3. تنظیم مجدد API Key از طریق پنل ادمین

### مشکل 2: "API Key باید حداقل 16 کاراکتر باشد"

**علت:** کلید وارد شده کوتاه است

**راه حل:**
1. کلید طولانی‌تر وارد کنید
2. از ترکیب حروف، اعداد و کاراکترهای مجاز استفاده کنید

### مشکل 3: "کاراکترهای غیرمجاز"

**علت:** استفاده از کاراکترهای غیرمجاز

**راه حل:**
1. فقط از حروف، اعداد و کاراکترهای `-`, `_`, `.` استفاده کنید
2. از فاصله و کاراکترهای خاص دیگر استفاده نکنید

## 💡 نکات امنیتی

1. **کلید قوی انتخاب کنید**: حداقل 16 کاراکتر با ترکیب حروف، اعداد و کاراکترهای خاص
2. **کلید را مخفی نگه دارید**: در جای امنی ذخیره کنید
3. **کلید را منظم تغییر دهید**: برای امنیت بیشتر، کلید را به صورت منظم تغییر دهید
4. **کلید را به اشتراک نگذارید**: کلید را با هیچ‌کس به اشتراک نگذارید
5. **لاگ‌ها را بررسی کنید**: در صورت شک به نشت کلید، آن را تغییر دهید

## 🔄 بروزرسانی API Key

### از طریق پنل ادمین:
1. منوی ادمین → 🔑 تنظیم API Key
2. وارد کردن کلید جدید
3. تایید و ذخیره

### از طریق فایل .env:
1. ویرایش فایل `.env`
2. تغییر مقدار `ADMIN_API_KEY`
3. restart کردن ربات

## 📊 تست عملکرد

### تست 1: بررسی API Key فعلی
```
منوی ادمین → 🔑 تنظیم API Key
```

### تست 2: تست بروزرسانی لینک‌ها
```
منوی ادمین → 🔄 بروزرسانی همه لینک‌ها
```

### تست 3: تست endpoint
```bash
curl -X POST https://your-domain.com/admin/update_configs/1 \
  -H "Authorization: Bearer your-api-key"
```

## 🎯 نتیجه

با تنظیم صحیح API Key:
- ✅ درخواست‌های ادمین احراز هویت می‌شوند
- ✅ دکمه "بروزرسانی همه لینک‌ها" کار می‌کند
- ✅ امنیت سیستم تضمین می‌شود
- ✅ کنترل دسترسی کامل است
